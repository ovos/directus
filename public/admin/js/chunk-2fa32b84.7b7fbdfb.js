(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2fa32b84"],{"02c1":function(e,t,n){"use strict";var i=n("698e"),r=n.n(i);r.a},"035b":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"interface-many-to-many"},[!1===e.relationshipSetup?n("v-notice",{attrs:{color:"warning",icon:"warning"}},[e._v("\n    "+e._s(e.$t("relationship_not_setup"))+"\n  ")]):[e.items.length?n("div",{staticClass:"table"},[n("div",{staticClass:"header"},[n("div",{staticClass:"row"},[e.sortable?n("button",{staticClass:"sort-column",on:{click:e.toggleManualSort}},[n("v-icon",{attrs:{name:"sort",size:"18",color:e.manualSortActive?"action":"light-gray"}})],1):e._e(),e._l(e.visibleFields,function(t){return n("button",{key:t.field,attrs:{type:"button"},on:{click:function(n){return e.changeSort(t.field)}}},[e._v("\n            "+e._s(e.$helpers.formatTitle(t.field))+"\n            "),e.sort.field===t.field?n("v-icon",{attrs:{name:e.sort.asc?"arrow_downward":"arrow_upward",size:"16"}}):e._e()],1)})],2)]),n("draggable",{staticClass:"body",class:{dragging:e.dragging,readonly:e.readonly},attrs:{handle:".drag-handle",disabled:!e.sortable||!e.manualSortActive},on:{start:function(t){e.dragging=!0},end:function(t){e.dragging=!1}},model:{value:e.itemsSorted,callback:function(t){e.itemsSorted=t},expression:"itemsSorted"}},e._l(e.itemsSorted,function(t){return n("div",{key:t[e.junctionRelatedKey][e.relatedPrimaryKeyField]||t.$tempKey,staticClass:"row",on:{click:function(n){return e.startEdit(t[e.junctionPrimaryKey])}}},[e.sortable?n("div",{staticClass:"sort-column",class:{disabled:!e.manualSortActive}},[e.readonly?e._e():n("v-icon",{staticClass:"drag-handle",attrs:{name:"drag_handle"}})],1):e._e(),e._l(e.visibleFields,function(i){return n("div",{key:i.field},[n("v-ext-display",{attrs:{"interface-type":i.interface,name:i.field,type:i.type,collection:i.collection,datatype:i.datatype,options:i.options,value:t[e.junctionRelatedKey][i.field]}})],1)}),e.readonly?e._e():n("button",{staticClass:"remove",on:{click:function(n){return n.stopPropagation(),e.deleteItem(t[e.junctionPrimaryKey])}}},[n("v-icon",{attrs:{name:"close"}})],1)],2)}),0)],1):n("v-notice",[e._v(e._s(e.$t("no_items_selected")))]),e.readonly?e._e():n("div",{staticClass:"buttons"},[e.options.allow_create?n("v-button",{attrs:{type:"button",disabled:e.readonly,icon:"add"},on:{click:e.startAddNewItem}},[e._v("\n        "+e._s(e.$t("add_new"))+"\n      ")]):e._e(),e.options.allow_select?n("v-button",{attrs:{type:"button",disabled:e.readonly,icon:"playlist_add"},on:{click:function(t){e.selectExisting=!0}}},[e._v("\n        "+e._s(e.$t("select_existing"))+"\n      ")]):e._e()],1)],e.selectExisting?n("v-item-select",{attrs:{fields:e.visibleFieldNames,collection:e.relation.junction.collection_one.collection,filters:[],value:e.stagedSelection||e.selectionPrimaryKeys},on:{input:e.stageSelection,done:e.closeSelection,cancel:e.cancelSelection}}):e._e(),e.editItem?n("portal",{attrs:{to:"modal"}},[n("v-modal",{attrs:{title:e.addNew?e.$t("creating_item"):e.$t("editing_item"),buttons:{save:{text:e.$t("save"),color:"accent"}}},on:{close:e.closeEditItem,save:e.saveEditItem}},[n("div",{staticClass:"edit-modal-body"},[n("v-form",{attrs:{"new-item":"",fields:e.relation.junction.collection_one.fields,collection:e.relation.junction.collection_one.collection,values:e.editItem[e.junctionRelatedKey]},on:{"stage-value":e.stageValue}})],1)])],1):e._e()],2)},r=[],a=(n("ac6a"),n("456d"),n("6762"),n("2fdb"),n("f559"),n("96cf"),n("3b8d")),o=n("75fc"),l=n("bd86"),c=n("cebc"),s=(n("55dd"),n("7514"),n("28a5"),n("8db2")),u=n.n(s),d=n("649d"),f=n("8dee"),y=n.n(f),p={name:"InterfaceManyToMany",mixins:[u.a],data:function(){return{sort:{field:null,asc:!0},selectExisting:!1,editItem:!1,addNew:null,dragging:!1,items:null,loading:!1,error:null,stagedSelection:null,initialValue:_.cloneDeep(this.value)||[]}},computed:{relationshipSetup:function(){return!!this.relation},visibleFields:function(){if(!1===this.relationSetup)return[];if(!this.options.fields)return[];var e;Array.isArray(this.options.fields)&&(e=this.options.fields.map(function(e){return e.trim()})),e=this.options.fields.split(",").map(function(e){return e.trim()});var t=this.relation.junction.collection_one.fields,n=_.get(this.relation,"junction.field_one.field",null);return e.map(function(e){var i=t[e];return n&&e===n&&(i.readonly=!0),i})},visibleFieldNames:function(){return this.visibleFields.map(function(e){return e.field})},relatedPrimaryKeyField:function(){return _.find(this.relation.junction.collection_one.fields,{primary_key:!0}).field},selectionPrimaryKeys:function(){var e=this;return this.items.map(function(t){return t[e.junctionRelatedKey][e.relatedPrimaryKeyField]})},sortField:function(){var e=this.relation.collection_many.fields,t=_.find(e,{type:"sort"});return t},sortable:function(){return!!this.sortField},manualSortActive:function(){return"$manual"===this.sort.field},junctionRelatedKey:function(){return this.relation.junction.field_many.field},junctionPrimaryKey:function(){return _.find(this.relation.junction.collection_many.fields,{primary_key:!0}).field},itemsSorted:{get:function(){var e=this;return"$manual"===this.sort.field?_.orderBy(_.cloneDeep(this.items),function(t){return t[e.sortField.field]},this.sort.asc?"asc":"desc"):_.orderBy(_.cloneDeep(this.items),function(t){return t[e.junctionRelatedKey][e.sort.field]},this.sort.asc?"asc":"desc")},set:function(e){var t=this;this.items=e.map(function(e,n){return Object(c["a"])({},e,Object(l["a"])({},t.sortField.field,n+1))})}}},watch:{items:function(e,t){null!==t&&this.emitValue(e)}},created:function(){var e=this;this.sortable?this.sort.field="$manual":this.visibleFields&&this.visibleFields.length>0&&(this.sort.field=this.visibleFields[0].field),this.items=(_.cloneDeep(this.value)||[]).filter(function(t){return t[e.junctionRelatedKey]})},methods:{changeSort:function(e){this.sort.field!==e?(this.sort.asc=!0,this.sort.field=e):this.sort.asc=!this.sort.asc},startAddNewItem:function(){var e;this.addNew=!0;var t=this.relation.junction.collection_one.fields,n=_.mapValues(t,function(e){return e.default_value}),i="$temp_"+y.a.generate();n.hasOwnProperty(this.relatedPrimaryKeyField)&&delete n[this.relatedPrimaryKeyField],this.items=[].concat(Object(o["a"])(this.items),[(e={},Object(l["a"])(e,this.junctionPrimaryKey,i),Object(l["a"])(e,this.junctionRelatedKey,n),e)]),this.startEdit(i)},stageValue:function(e){var t=e.field,n=e.value;this.$set(this.editItem[this.junctionRelatedKey],t,n)},toggleManualSort:function(){this.sort.field="$manual",this.sort.asc=!0},startEdit:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(t){var n,i,r,a,o,l=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=_.cloneDeep(this.items.find(function(e){return e[l.junctionPrimaryKey]===t})),i="string"===typeof t&&t.startsWith("$temp_"),!1!==i){e.next=9;break}return r=this.relation.collection_many.collection,e.next=6,this.$api.getItem(r,t,{fields:"*.*.*"});case 6:a=e.sent,o=a.data,n=_.merge({},o,n);case 9:this.editItem=n;case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),saveEditItem:function(){var e=this,t=this.editItem[this.junctionPrimaryKey];this.items=this.items.map(function(n){return n[e.junctionPrimaryKey]===t?e.editItem:n}),this.editItem=null},closeEditItem:function(){this.editItem=null},stageSelection:function(e){this.stagedSelection=e},closeSelection:function(){var e=Object(a["a"])(regeneratorRuntime.mark(function e(){var t,n,i,r,a,c,s=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.stagedSelection||[],this.items=this.items.filter(function(e){var n=e[s.junctionRelatedKey][s.relatedPrimaryKeyField];return t.includes(n)}),n=this.items.map(function(e){return e[s.junctionRelatedKey][s.relatedPrimaryKeyField]}),i=_.difference(t,n),e.next=6,this.$api.getItem(this.relation.junction.collection_one.collection,i.join(","),{fields:"*.*.*"});case 6:r=e.sent,a=Array.isArray(r.data)?r.data:[r.data],c=a.map(function(e){var t,n="$temp_"+y.a.generate();return t={},Object(l["a"])(t,s.junctionPrimaryKey,n),Object(l["a"])(t,s.junctionRelatedKey,e),t}),this.items=[].concat(Object(o["a"])(this.items),Object(o["a"])(c)),this.stagedSelection=null,this.selectExisting=!1;case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),cancelSelection:function(){this.stagedSelection=null,this.selectExisting=null},deleteItem:function(e){var t=this;this.items=this.items.filter(function(n){var i=n[t.junctionPrimaryKey];return i!==e})},emitValue:function(e){var t=this;e=_.cloneDeep(e);var n=_.get(this.relation,"junction.field_one.field",null),i=e.map(function(e){var i=e[t.junctionPrimaryKey],r=t.initialValue.find(function(e){return e[t.junctionPrimaryKey]===i});if(r){var a=Object(d["diff"])(r,e);if(Object.keys(a).length>0){var o,c=(o={},Object(l["a"])(o,t.junctionPrimaryKey,i),Object(l["a"])(o,t.junctionRelatedKey,Object(l["a"])({},t.relatedPrimaryKeyField,r[t.junctionRelatedKey][t.relatedPrimaryKeyField])),o);return n&&c[t.junctionRelatedKey].hasOwnProperty(n)&&delete c[t.junctionRelatedKey][n],_.merge({},c,a)}return null}return e[t.junctionPrimaryKey].startsWith("$temp_")&&delete e[t.junctionPrimaryKey],e}).filter(function(e){return e}),r=this.initialValue.map(function(e){return e[t.junctionPrimaryKey]}),a=e.map(function(e){return e[t.junctionPrimaryKey]}),c=_.difference(r,a),s=c.map(function(e){var n;return n={},Object(l["a"])(n,t.junctionPrimaryKey,e),Object(l["a"])(n,"$delete",!0),n});this.$emit("input",[].concat(Object(o["a"])(i),Object(o["a"])(s)))}}},m=p,v=(n("02c1"),n("2877")),b=Object(v["a"])(m,i,r,!1,null,"ff1efb4e",null);t["default"]=b.exports},2752:function(e,t,n){var i,r,a;(function(o,l){r=[e,t,n("adec")],i=l,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function e(t,a){if(t===a||!(0,n.isObject)(t)||!(0,n.isObject)(a))return{};var o=(0,n.properObject)(t),l=(0,n.properObject)(a);return Object.keys(o).reduce(function(t,a){if(l.hasOwnProperty(a)){var c=e(o[a],l[a]);return(0,n.isObject)(c)&&(0,n.isEmpty)(c)?t:r({},t,i({},a,c))}return r({},t,i({},a,void 0))},{})};t.default=a,e.exports=t["default"]})},"49c0":function(e,t,n){var i,r,a;(function(o,l){r=[e,t,n("adec")],i=l,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function e(t,a){if(t===a||!(0,n.isObject)(t)||!(0,n.isObject)(a))return{};var o=(0,n.properObject)(t),l=(0,n.properObject)(a);return Object.keys(l).reduce(function(t,a){if(o.hasOwnProperty(a)){var c=e(o[a],l[a]);return(0,n.isObject)(c)&&(0,n.isEmpty)(c)?t:r({},t,i({},a,c))}return r({},t,i({},a,l[a]))},{})};t.default=a,e.exports=t["default"]})},"49eb":function(e,t,n){var i,r,a;(function(o,l){r=[e,t,n("adec")],i=l,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function e(t,a){if(t===a)return{};if(!(0,n.isObject)(t)||!(0,n.isObject)(a))return a;var o=(0,n.properObject)(t),l=(0,n.properObject)(a);return(0,n.isDate)(o)||(0,n.isDate)(l)?o.valueOf()==l.valueOf()?{}:l:Object.keys(l).reduce(function(t,a){if(o.hasOwnProperty(a)){var c=e(o[a],l[a]);return(0,n.isObject)(c)&&(0,n.isEmpty)(c)&&!(0,n.isDate)(c)?t:r({},t,i({},a,c))}return t},{})};t.default=a,e.exports=t["default"]})},"50e0":function(e,t,n){var i,r,a;(function(o,l){r=[e,t,n("adec")],i=l,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e,t,n){"use strict";function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a=function e(t,a){if(t===a)return{};if(!(0,n.isObject)(t)||!(0,n.isObject)(a))return a;var o=(0,n.properObject)(t),l=(0,n.properObject)(a),c=Object.keys(o).reduce(function(e,t){return l.hasOwnProperty(t)?e:r({},e,i({},t,void 0))},{});return(0,n.isDate)(o)||(0,n.isDate)(l)?o.valueOf()==l.valueOf()?{}:l:Object.keys(l).reduce(function(t,a){if(!o.hasOwnProperty(a))return r({},t,i({},a,l[a]));var c=e(o[a],l[a]);return(0,n.isObject)(c)&&(0,n.isEmpty)(c)&&!(0,n.isDate)(c)?t:r({},t,i({},a,c))},c)};t.default=a,e.exports=t["default"]})},"649d":function(e,t,n){var i,r,a;(function(o,l){r=[t,n("50e0"),n("49c0"),n("2752"),n("49eb"),n("eadc")],i=l,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e,t,n,i,r,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.detailedDiff=e.updatedDiff=e.deletedDiff=e.diff=e.addedDiff=void 0;var o=d(t),l=d(n),c=d(i),s=d(r),u=d(a);function d(e){return e&&e.__esModule?e:{default:e}}e.addedDiff=l.default,e.diff=o.default,e.deletedDiff=c.default,e.updatedDiff=s.default,e.detailedDiff=u.default})},"698e":function(e,t,n){},"8db2":function(e,t){e.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},collection:{type:String,default:null},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null}}}},adec:function(e,t,n){var i,r,a;(function(n,o){r=[t],i=o,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(e.isDate=function(e){return e instanceof Date},e.isEmpty=function(e){return 0===Object.keys(e).length},e.isObject=function(e){return null!=e&&"object"===("undefined"===typeof e?"undefined":n(e))});e.properObject=function(e){return i(e)&&!e.hasOwnProperty?t({},e):e}})},eadc:function(e,t,n){var i,r,a;(function(o,l){r=[e,t,n("49c0"),n("2752"),n("49eb")],i=l,a="function"===typeof i?i.apply(t,r):i,void 0===a||(e.exports=a)})(0,function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=c(n),o=c(i),l=c(r);function c(e){return e&&e.__esModule?e:{default:e}}var s=function(e,t){return{added:(0,a.default)(e,t),deleted:(0,o.default)(e,t),updated:(0,l.default)(e,t)}};t.default=s,e.exports=t["default"]})}}]);
//# sourceMappingURL=chunk-2fa32b84.7b7fbdfb.js.map